// Smart chatbot logic that understands Hebrew questions and provides relevant answers

export interface Message {
  id: string;
  text: string;
  sender: 'user' | 'bot';
  timestamp: Date;
}

interface QuestionPattern {
  patterns: string[];
  response: string;
  category?: string;
}

// Knowledge base from site content
const knowledgeBase: QuestionPattern[] = [
  // Greetings
  {
    patterns: ['שלום', 'היי', 'הי', 'בוקר טוב', 'ערב טוב', 'מה קורה', 'מה המצב'],
    response: 'שלום! 👋 אני הבוט החכם של Pixelia. אני כאן לעזור לך עם כל שאלה על השירותים שלנו, מחירים, תהליך העבודה ועוד. במה אוכל לעזור?',
    category: 'greeting'
  },

  // Services & Pricing
  {
    patterns: ['מחיר', 'עלות', 'כמה', 'תעריף', 'עולה', 'שווה', 'מחירון'],
    response: `💰 **המחירים שלנו:**

📄 **דף נחיתה** - החל מ-2,000 ₪
עמוד בודד ממוקד המיועד להמרות גבוהות

🏢 **אתר תדמית לעסק** - החל מ-3,500 ₪
אתר מלא עם 3-7 עמודים

🎨 **אתר פורטפוליו** - החל מ-2,500 ₪
מושלם למעצבים, צלמים ואמנים

🛍️ **מיני חנות/קטלוג** - החל מ-4,000 ₪
הצגת מוצרים עם כפתורי WhatsApp להזמנה

רוצה לשמוע עוד על שירות מסוים?`,
    category: 'pricing'
  },

  // Landing page
  {
    patterns: ['דף נחיתה', 'לנדינג', 'landing', 'עמוד בודד', 'דף יחיד'],
    response: `📄 **דף נחיתה** - החל מ-2,000 ₪

עמוד בודד ממוקד המיועד להמרות גבוהות - מושלם לקמפיינים, השקות מוצרים וכנסים.

✅ כולל:
• עיצוב ממוקד המרה
• אופטימיזציה למובייל
• טפסים ו-CTA חזקים
• אינטגרציה עם כלי שיווק

מעוניין להתחיל?`,
    category: 'service'
  },

  // Business website
  {
    patterns: ['אתר תדמית', 'אתר לעסק', 'אתר עסקי', 'אתר חברה', 'אתר עבודה'],
    response: `🏢 **אתר תדמית לעסק** - החל מ-3,500 ₪

אתר מלא עם מספר עמודים המציג את העסק שלך בצורה מקצועית ומרשימה.

✅ כולל:
• 3-7 עמודים
• גלריית עבודות
• מערכת המלצות
• טופס יצירת קשר מתקדם

בואו ניצור את האתר המושלם לעסק שלך!`,
    category: 'service'
  },

  // Portfolio
  {
    patterns: ['פורטפוליו', 'תיק עבודות', 'גלריה', 'אתר צלם', 'אתר מעצב'],
    response: `🎨 **אתר פורטפוליו** - החל מ-2,500 ₪

מושלם למעצבים, צלמים, אמנים וכל מי שצריך להציג עבודות.

✅ כולל:
• גלריות תמונות מתקדמות
• עיצוב ייחודי ומרשים
• אנימציות חלקות
• אופטימיזציה לתמונות

מוכן להציג את העבודות שלך באופן מקצועי?`,
    category: 'service'
  },

  // E-commerce
  {
    patterns: ['חנות', 'מוצרים', 'קטלוג', 'ecommerce', 'אי קומרס', 'מכירה'],
    response: `🛍️ **מיני חנות/קטלוג מוצרים** - החל מ-4,000 ₪

הצגת מוצרים ללא מערכת תשלומים מלאה - מושלם לעסקים קטנים.

✅ כולל:
• קטלוג מוצרים
• פילטרים וחיפוש
• כפתורי WhatsApp להזמנה
• ניהול מלאי פשוט

מעוניין להציג את המוצרים שלך אונליין?`,
    category: 'service'
  },

  // Process
  {
    patterns: ['תהליך', 'איך זה עובד', 'שלבים', 'מה הדרך', 'איך מתחילים', 'זמן'],
    response: `⚡ **תהליך העבודה שלנו:**

**שלב 1** - שיחה והבנת צרכים 💬
נפגש לשיחה קצרה כדי להבין את העסק והמטרות שלך

**שלב 2** - בחירת תבנית 🎨
תבחר מתוך 12 תבניות מעוצבות או נתאים יחד

**שלב 3** - התאמות תוכן ועיצוב ✏️
נתאים צבעים, לוגו, תמונות וטקסטים למותג שלך

**שלב 4** - העלאה לאוויר 🚀
נעלה את האתר, נחבר דומיין ונעביר הדרכה

**זמן ביצוע:** בין 5-14 ימי עבודה בממוצע

רוצה להתחיל?`,
    category: 'process'
  },

  // About / Experience
  {
    patterns: ['ניסיון', 'מי אתם', 'על החברה', 'רקע', 'עבודות קודמות', 'פרויקטים'],
    response: `👨‍💻 **אודות Pixelia:**

✅ 5+ שנות ניסיון בפיתוח אתרים
✅ למעלה מ-50 אתרים שהשקנו בהצלחה
✅ מומחיות בעיצוב רספונסיבי
✅ ליווי אישי לכל לקוח
✅ תמיכה שוטפת לאחר השקה

**טכנולוגיות:** Next.js, React, TypeScript, Tailwind CSS, Node.js, WordPress

אנחנו מתמחים בעזרה לעסקים קטנים ובינוניים להשיק נוכחות דיגיטלית מושלמת במהירות ובמחיר הוגן.`,
    category: 'about'
  },

  // Technologies
  {
    patterns: ['טכנולוגי', 'מה בונים', 'איזה שפה', 'קוד', 'פיתוח', 'תכנות'],
    response: `💻 **הטכנולוגיות שלנו:**

• **Next.js** - פריימוורק מתקדם לאתרים מהירים
• **React** - ספריית JavaScript מובילה
• **TypeScript** - קוד בטוח ואיכותי
• **Tailwind CSS** - עיצוב מודרני וגמיש
• **Node.js** - צד שרת חזק
• **WordPress** - למי שמעדיף CMS קלאסי

כל הטכנולוגיות מבטיחות ביצועים מעולים וחוויית משתמש מהירה!`,
    category: 'tech'
  },

  // Templates
  {
    patterns: ['תבנית', 'דוגמאות', 'טמפלייט', 'template', 'עיצובים', 'להציג'],
    response: `🎨 **יש לנו 12 תבניות מעוצבות:**

• Classic Business - עסקי קלאסי
• Creative Agency - סוכנות יצירתית
• Minimal Portfolio - פורטפוליו מינימליסטי
• Modern Coach - מאמן אישי
• Photographer - צלם מקצועי
• Restaurant - מסעדה
• Medical Clinic - מרפאה רפואית
• Lawyer - עורך דין
• Fitness Studio - חדר כושר
• Real Estate - נדל"ן
• Event Landing - דף נחיתה לאירוע
• Mini Shop - חנות מיני

כל תבנית ניתנת להתאמה מלאה למותג שלך! רוצה לראות אותן? [לחץ על "תבניות" בתפריט למעלה]`,
    category: 'templates'
  },

  // Advantages / Benefits
  {
    patterns: ['למה', 'יתרונות', 'מה מיוחד', 'למה לבחור', 'הבדל', 'כדאי'],
    response: `⭐ **למה לבחור ב-Pixelia?**

🎨 **עיצוב מותאם אישית**
התאמה מלאה - צבעים, לוגו, תמונות וטקסטים

📱 **רספונסיבי מלא**
מושלם במובייל, טאבלט ומחשב

⚡ **ביצועים מהירים**
טכנולוגיות מתקדמות לזמני טעינה מהירים

🤝 **ליווי אישי**
תמיכה מלאה לאורך כל התהליך ואחרי

💰 **מחיר הוגן**
איכות גבוהה במחירים נגישים`,
    category: 'benefits'
  },

  // Contact
  {
    patterns: ['צור קשר', 'יצירת קשר', 'ליצור קשר', 'לדבר', 'טלפון', 'אימייל', 'וואטסאפ', 'whatsapp'],
    response: `📞 **נשמח לשמוע ממך!**

📱 **טלפון:** 054-6361555
📧 **אימייל:** ilyaig8@gmail.com
💬 **WhatsApp:** [לחץ כאן](https://wa.me/972546361555)
📍 **מיקום:** תל אביב, ישראל

אפשר גם למלא את טופס יצירת הקשר באתר ואחזור אליך בהקדם!`,
    category: 'contact'
  },

  // Mobile / Responsive
  {
    patterns: ['מובייל', 'סלולר', 'טלפון נייד', 'רספונסיבי', 'responsive'],
    response: `📱 **כל האתרים שלנו רספונסיביים מלא!**

✅ מותאמים באופן מושלם למובייל
✅ חוויית משתמש מעולה בטאבלט
✅ מעוצבים מושלם גם במחשב

אנחנו שמים דגש מיוחד על תצוגה מושלמת בכל מכשיר - כי היום רוב הגולשים גולשים ממובייל!`,
    category: 'features'
  },

  // Timeline / Duration
  {
    patterns: ['כמה זמן', 'משך זמן', 'תוך כמה', 'מתי מוכן', 'זמן ביצוע', 'מהירות'],
    response: `⏱️ **זמני ביצוע:**

📄 **דף נחיתה:** 5-7 ימי עבודה
🏢 **אתר תדמית:** 7-10 ימי עבודה
🎨 **פורטפוליו:** 7-10 ימי עבודה
🛍️ **מיני חנות:** 10-14 ימי עבודה

*הזמנים תלויים במורכבות הפרויקט ובזמינות התכנים*

אנחנו עובדים מהר אבל לא מתפשרים על איכות! 🚀`,
    category: 'timeline'
  },

  // Support / Maintenance
  {
    patterns: ['תמיכה', 'תחזוקה', 'עדכונים', 'אחזקה', 'בעיות', 'עזרה', 'סיוע'],
    response: `🛠️ **תמיכה ותחזוקה:**

✅ תמיכה מלאה לאורך כל התהליך
✅ הדרכה על השימוש באתר
✅ תמיכה שוטפת לאחר השקה
✅ עדכונים ושיפורים לפי הצורך

אנחנו כאן בשבילך גם אחרי שהאתר עולה לאוויר! אם יש בעיה או שאלה - פשוט תיצור קשר.`,
    category: 'support'
  },

  // Payment / Installments
  {
    patterns: ['תשלום', 'תשלומים', 'לשלם', 'אשראי', 'העברה', 'חשבונית'],
    response: `💳 **אפשרויות תשלום:**

✅ העברה בנקאית
✅ תשלום באשראי
✅ אפשרות לפריסה לתשלומים (בתיאום)
✅ חשבונית + מע"מ

**תנאי תשלום רגילים:**
• 50% בתחילת הפרויקט
• 50% עם העלאה לאוויר

כל התשלומים עם חשבונית מס כמובן.`,
    category: 'payment'
  },

  // Domain & Hosting
  {
    patterns: ['דומיין', 'אחסון', 'domain', 'hosting', 'שרת'],
    response: `🌐 **דומיין ואחסון:**

✅ עזרה בבחירת ורכישת דומיין
✅ חיבור הדומיין לאתר
✅ המלצה על אחסון מהיר ואמין
✅ הקמת האתר על הדומיין שלך

אפשר לבחור אחסון משלך או שאני אמליץ על פתרונות מעולים שעובדים איתם.`,
    category: 'technical'
  },

  // Thank you / Goodbye
  {
    patterns: ['תודה', 'תודה רבה', 'מעולה', 'נהדר', 'סופר', 'ביי', 'להתראות', 'שלום'],
    response: 'בכיף! 😊 אם יש עוד שאלות - אני כאן. אפשר גם ליצור קשר ישירות דרך הטלפון או WhatsApp: 054-6361555',
    category: 'farewell'
  }
];

// Find the best matching response for user input
export function getBotResponse(userInput: string): string {
  const normalizedInput = userInput.toLowerCase().trim();

  // Find matching patterns
  for (const item of knowledgeBase) {
    for (const pattern of item.patterns) {
      if (normalizedInput.includes(pattern)) {
        return item.response;
      }
    }
  }

  // Default response if no match found
  return `🤔 אני לא בטוח שהבנתי את השאלה.

אני יכול לעזור עם:
• **מחירים ושירותים** - כמה עולה אתר?
• **תהליך העבודה** - איך זה עובד?
• **תבניות** - איזה עיצובים יש?
• **טכנולוגיות** - מה משתמשים?
• **יצירת קשר** - איך ליצור קשר?

פשוט תשאל אותי! 😊`;
}

// Generate quick reply suggestions based on context
export function getQuickReplies(lastBotMessage?: string): string[] {
  if (!lastBotMessage) {
    return ['מחירים', 'איך זה עובד?', 'לראות תבניות', 'צור קשר'];
  }

  // Context-aware suggestions
  if (lastBotMessage.includes('מחיר')) {
    return ['תהליך העבודה', 'לראות תבניות', 'כמה זמן לוקח?', 'צור קשר'];
  }

  if (lastBotMessage.includes('תהליך')) {
    return ['מחירים', 'כמה זמן לוקח?', 'לראות תבניות', 'בואו נדבר'];
  }

  if (lastBotMessage.includes('תבנית')) {
    return ['מחירים', 'איך זה עובד?', 'צור קשר', 'מה מיוחד?'];
  }

  return ['עוד שאלות', 'מחירים', 'צור קשר', 'תודה'];
}

// Generate unique ID for messages
export function generateMessageId(): string {
  return `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
}